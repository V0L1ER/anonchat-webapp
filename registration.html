<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        .subtitle {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999999);
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 12px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus {
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        .gender-buttons {
            display: flex;
            gap: 12px;
        }

        .gender-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 12px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .gender-btn.active {
            border-color: var(--tg-theme-button-color, #3390ec);
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .interests-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .interest-tag {
            padding: 8px 16px;
            border: 2px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .interest-tag.active {
            border-color: var(--tg-theme-button-color, #3390ec);
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .error {
            color: #ff3b30;
            font-size: 13px;
            margin-top: 4px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .progress {
            width: 100%;
            height: 4px;
            background-color: var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--tg-theme-button-color, #3390ec);
            width: 0%;
            transition: width 0.3s;
        }

        .hint {
            font-size: 13px;
            color: var(--tg-theme-hint-color, #999999);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
        <p class="subtitle">–ó–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ—Ñ–∏–ª—å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>

        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <form id="registrationForm">
            <div class="form-group">
                <label for="name">–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? *</label>
                <input type="text" id="name" name="name" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ–µ –∏–º—è" required minlength="2" maxlength="50">
                <div class="error" id="nameError">–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤</div>
            </div>

            <div class="form-group">
                <label>–¢–≤–æ–π –ø–æ–ª *</label>
                <div class="gender-buttons">
                    <button type="button" class="gender-btn" data-gender="male">
                        üë® –ú—É–∂—Å–∫–æ–π
                    </button>
                    <button type="button" class="gender-btn" data-gender="female">
                        üë© –ñ–µ–Ω—Å–∫–∏–π
                    </button>
                </div>
                <div class="error" id="genderError">–í—ã–±–µ—Ä–∏ –ø–æ–ª</div>
            </div>

            <div class="form-group">
                <label for="age">–°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç? *</label>
                <input type="number" id="age" name="age" placeholder="–í–≤–µ–¥–∏ –≤–æ–∑—Ä–∞—Å—Ç" required min="13" max="100">
                <div class="error" id="ageError">–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 13 –¥–æ 100 –ª–µ—Ç</div>
            </div>

            <div class="form-group">
                <label for="city">–¢–≤–æ–π –≥–æ—Ä–æ–¥ *</label>
                <input type="text" id="city" name="city" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞" required minlength="2" maxlength="50">
                <div class="error" id="cityError">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤</div>
            </div>

            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã (–º–∏–Ω–∏–º—É–º 1) *</label>
                <div class="interests-container" id="interestsContainer">
                    <div class="interest-tag" data-interest="–ú—É–∑—ã–∫–∞">üéµ –ú—É–∑—ã–∫–∞</div>
                    <div class="interest-tag" data-interest="–ö–∏–Ω–æ">üé¨ –ö–∏–Ω–æ</div>
                    <div class="interest-tag" data-interest="–°–ø–æ—Ä—Ç">‚öΩ –°–ø–æ—Ä—Ç</div>
                    <div class="interest-tag" data-interest="–ò–≥—Ä—ã">üéÆ –ò–≥—Ä—ã</div>
                    <div class="interest-tag" data-interest="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</div>
                    <div class="interest-tag" data-interest="–ö–Ω–∏–≥–∏">üìö –ö–Ω–∏–≥–∏</div>
                    <div class="interest-tag" data-interest="–ò—Å–∫—É—Å—Å—Ç–≤–æ">üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ</div>
                    <div class="interest-tag" data-interest="–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏">üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
                    <div class="interest-tag" data-interest="–ü—Ä–∏—Ä–æ–¥–∞">üåø –ü—Ä–∏—Ä–æ–¥–∞</div>
                    <div class="interest-tag" data-interest="–ï–¥–∞">üçï –ï–¥–∞</div>
                    <div class="interest-tag" data-interest="–ú–æ–¥–∞">üëó –ú–æ–¥–∞</div>
                    <div class="interest-tag" data-interest="–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</div>
                </div>
                <div class="error" id="interestsError">–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä–µ—Å</div>
                <div class="hint">–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤</div>
            </div>
        </form>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        console.log('WebApp initialized:', tg);
        console.log('WebApp version:', tg.version);
        console.log('sendData available:', typeof tg.sendData);
        
        tg.expand();
        tg.enableClosingConfirmation();

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram
        document.body.style.backgroundColor = tg.themeParams.bg_color || '#ffffff';

        // –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
        let formData = {
            name: '',
            gender: '',
            age: null,
            city: '',
            interests: []
        };

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞
        const genderButtons = document.querySelectorAll('.gender-btn');
        genderButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                genderButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                formData.gender = btn.dataset.gender;
                document.getElementById('genderError').classList.remove('show');
                updateProgress();
            });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
        const interestTags = document.querySelectorAll('.interest-tag');
        interestTags.forEach(tag => {
            tag.addEventListener('click', () => {
                tag.classList.toggle('active');
                const interest = tag.dataset.interest;
                
                if (tag.classList.contains('active')) {
                    if (!formData.interests.includes(interest)) {
                        formData.interests.push(interest);
                    }
                } else {
                    formData.interests = formData.interests.filter(i => i !== interest);
                }
                
                document.getElementById('interestsError').classList.remove('show');
                updateProgress();
            });
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
        const nameInput = document.getElementById('name');
        const ageInput = document.getElementById('age');
        const cityInput = document.getElementById('city');

        nameInput.addEventListener('input', (e) => {
            formData.name = e.target.value.trim();
            document.getElementById('nameError').classList.remove('show');
            updateProgress();
        });

        ageInput.addEventListener('input', (e) => {
            formData.age = parseInt(e.target.value);
            document.getElementById('ageError').classList.remove('show');
            updateProgress();
        });

        cityInput.addEventListener('input', (e) => {
            formData.city = e.target.value.trim();
            document.getElementById('cityError').classList.remove('show');
            updateProgress();
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        function updateProgress() {
            let completed = 0;
            const total = 5;

            if (formData.name.length >= 2) completed++;
            if (formData.gender) completed++;
            if (formData.age >= 13 && formData.age <= 100) completed++;
            if (formData.city.length >= 2) completed++;
            if (formData.interests.length > 0) completed++;

            const progress = (completed / total) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // –í–∫–ª—é—á–∞–µ–º/–≤—ã–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
            if (completed === total) {
                tg.MainButton.show();
                tg.MainButton.enable();
            } else {
                tg.MainButton.disable();
            }
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        function validateForm() {
            let isValid = true;
            let errors = [];

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏
            if (formData.name.length < 2 || formData.name.length > 50) {
                document.getElementById('nameError').classList.add('show');
                errors.push('–∏–º—è');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∞
            if (!formData.gender) {
                document.getElementById('genderError').classList.add('show');
                errors.push('–ø–æ–ª');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞
            if (!formData.age || formData.age < 13 || formData.age > 100) {
                document.getElementById('ageError').classList.add('show');
                errors.push('–≤–æ–∑—Ä–∞—Å—Ç');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–æ–¥–∞
            if (formData.city.length < 2 || formData.city.length > 50) {
                document.getElementById('cityError').classList.add('show');
                errors.push('–≥–æ—Ä–æ–¥');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
            if (formData.interests.length === 0) {
                document.getElementById('interestsError').classList.add('show');
                errors.push('–∏–Ω—Ç–µ—Ä–µ—Å—ã');
                isValid = false;
            }

            if (!isValid) {
                console.log('Validation failed:', errors);
            } else {
                console.log('Validation passed. Data:', formData);
            }

            return isValid;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
        tg.MainButton.text = '–ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ üéÅ';
        tg.MainButton.color = tg.themeParams.button_color || '#3390ec';
        tg.MainButton.textColor = tg.themeParams.button_text_color || '#ffffff';
        tg.MainButton.disable();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        let isSubmitting = false;
        
        tg.MainButton.onClick(() => {
            if (isSubmitting) return;
            
            console.log('Button clicked, form data:', formData);
            
            if (validateForm()) {
                isSubmitting = true;
                tg.MainButton.showProgress();
                tg.MainButton.disable();
                
                console.log('Form is valid, attempting to send data...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ sendData –¥–æ—Å—Ç—É–ø–µ–Ω
                if (typeof tg.sendData !== 'function') {
                    tg.MainButton.hideProgress();
                    tg.MainButton.enable();
                    isSubmitting = false;
                    tg.showAlert('–û—à–∏–±–∫–∞: sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω!\n\n–í–µ—Ä—Å–∏—è WebApp: ' + (tg.version || 'unknown') + '\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å Telegram.');
                    return;
                }
                
                try {
                    const dataToSend = JSON.stringify(formData);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö (–ª–∏–º–∏—Ç 4096 –±–∞–π—Ç)
                    if (dataToSend.length > 4096) {
                        tg.MainButton.hideProgress();
                        tg.MainButton.enable();
                        isSubmitting = false;
                        tg.showAlert('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ (' + dataToSend.length + ' –±–∞–π—Ç, –ª–∏–º–∏—Ç 4096)');
                        return;
                    }
                    
                    console.log('Sending data, length:', dataToSend.length);
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    tg.sendData(dataToSend);
                    
                    // sendData –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
                    // WebApp –¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    
                    // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –Ω–µ –∑–∞–∫—Ä—ã–ª—Å—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    setTimeout(() => {
                        tg.MainButton.hideProgress();
                        tg.showAlert('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!\n\n–ï—Å–ª–∏ WebApp –Ω–µ –∑–∞–∫—Ä—ã–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∑–∞–∫—Ä–æ–π—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é.');
                    }, 2000);
                    
                } catch (e) {
                    console.error('Error:', e);
                    tg.MainButton.hideProgress();
                    tg.MainButton.enable();
                    isSubmitting = false;
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + e.message);
                }
            } else {
                tg.HapticFeedback.notificationOccurred('error');
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–µ—Ä–≤–æ–º—É –ø–æ–ª—é —Å –æ—à–∏–±–∫–æ–π
                const firstError = document.querySelector('.error.show');
                if (firstError) {
                    firstError.parentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });

        // –ù–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateProgress();
        tg.ready();
    </script>
</body>
</html>
